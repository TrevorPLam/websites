# marketing-websites AI Documentation Index

Core documentation for AI assistants working with the marketing-websites platform.

## Repository Overview

marketing-websites is a pnpm monorepo for building multi-industry marketing websites using configuration-as-code architecture (CaCA). Single `site.config.ts` drives all client behavior - theming, page composition, features, SEO, integrations.

**Technology Stack:** Next.js 16.1.5, React 19, TypeScript 5.9.3, Tailwind CSS 4.1.0, pnpm 10.29.2, Turborepo 2.8.9

## Core Architecture

### Configuration-as-Code (CaCA)
- **Primary Config:** `clients/*/site.config.ts` - single source of truth
- **Validation:** Zod schemas from `@repo/types`
- **Features:** Theme, navigation, features toggles, integrations, SEO schema
- **Rule:** No hardcoded client values in components

### Layer Model
- **L0 Infrastructure:** `@repo/infra`, `@repo/integrations-*` (security, middleware, logging)
- **L2 Components:** `@repo/ui` (primitives), `@repo/features` (business logic), `@repo/types`, `@repo/utils`
- **L3 Experience:** `clients/*` (starter-template, luxe-salon, bistro-central, etc.)

### Dependency Rules
- **Allowed:** clients → @repo/* packages via public exports
- **Forbidden:** packages → clients, clients → clients, deep internal imports
- **Version Catalog:** Use `pnpm-workspace.yaml` catalog: versions

## Key Commands

```bash
# Development
pnpm install                    # Install workspace dependencies
pnpm dev                        # Start all dev servers
pnpm --filter @clients/starter-template dev  # Starter template (port 3101)

# Quality Gates
pnpm lint                       # ESLint across workspace
pnpm type-check                 # TypeScript validation
pnpm test                       # Jest test suite
pnpm build                      # Full build verification
pnpm validate-exports          # Package export validation
pnpm validate-client [path]     # Client configuration validation

# Package Management
pnpm --filter @repo/ui lint     # Package-specific operations
pnpm syncpack:check             # Dependency version consistency
```

## Package System

### @repo/ui - Component Library
- **Purpose:** Atomic React components with accessibility
- **Location:** `packages/ui/src/components/`
- **Exports:** Button, Dialog, Input, Label, Slider, Alert, Checkbox, Toast, ThemeInjector
- **Testing:** `@testing-library/react`, `jest-axe` for accessibility
- **Key Rule:** React as peer dependency, not direct

### @repo/features - Business Logic
- **Purpose:** Domain-specific feature modules
- **Modules:** booking, contact, blog, services, search
- **Structure:** actions/ (Server Actions), components/, hooks/, types/
- **Testing:** Server action validation, component integration

### @repo/types - Type Definitions
- **Purpose:** Shared TypeScript interfaces and schemas
- **Key Types:** SiteConfig, industry schemas, integration types
- **Validation:** Zod schemas for runtime validation

### @repo/infra - Infrastructure
- **Purpose:** Security, middleware, logging, environment validation
- **Features:** Rate limiting, CSP headers, request sanitization
- **Rule:** Server-only modules with client-safe exports

### @repo/utils - Utilities
- **Purpose:** Shared utility functions
- **Key:** `cn()` for conditional Tailwind class merging
- **Testing:** Pure function unit tests

## Client Implementation

### Starter Template
- **Location:** `clients/starter-template/`
- **Purpose:** Golden path for new clients
- **Port:** 3101 (each client uses unique port)
- **Config:** `site.config.ts` drives all behavior
- **Tech:** Next.js App Router, standalone Docker output

### Creating New Clients
```bash
cp -r clients/starter-template clients/my-client
# Update package.json name to @clients/my-client
# Modify site.config.ts for client-specific settings
# Configure .env.local environment variables
pnpm --filter @clients/my-client dev --port 3001
```

## Development Standards

### TypeScript
- **Strict Mode:** Enabled with noImplicitAny, noUnusedLocals, noUncheckedIndexedAccess
- **Target:** ES2022, bundler module resolution
- **Imports:** Use package public exports only

### React
- **Components:** Functional with hooks only
- **Server Components:** Use where possible in templates
- **Styling:** Tailwind CSS utilities with `cn()` helper

### Code Quality
- **ESLint:** Flat config (eslint.config.mjs) extending @repo/eslint-config
- **Prettier:** 100 char width, single quotes, trailing commas
- **Testing:** Jest with node/jsdom environments

## Testing Strategy

### Test Environments
- **Node:** Server utilities, infra, server actions
- **jsdom:** React components, UI primitives

### Coverage Targets
- **UI Components:** Rendering, accessibility, user interactions
- **Server Actions:** Input validation, rate limiting, error handling
- **Utilities:** Pure function correctness

### Key Test Files
- `packages/ui/src/components/__tests__/*.test.tsx`
- `packages/features/src/*/lib/__tests__/*.test.ts`
- Root `jest.config.js` with project configurations

## Environment Configuration

### Setup
```bash
cp .env.example clients/starter-template/.env.local
```

### Key Variables (all optional locally)
- `NEXT_PUBLIC_SITE_URL` - Public URL (default: http://localhost:3101)
- `NEXT_PUBLIC_SENTRY_DSN` - Error tracking
- `SUPABASE_URL` + `SUPABASE_SERVICE_ROLE_KEY` - Database/auth pair
- `UPSTASH_REDIS_REST_URL` + `UPSTASH_REDIS_REST_TOKEN` - Rate limiting pair

### Validation
- Environment schemas in `packages/infra/env/schemas/*.ts`
- Runtime validation with error reporting

## Integration Patterns

### Third-party Services
- **Structure:** `packages/integrations/{service}/` with adapter pattern
- **Services:** HubSpot, Supabase, Analytics, Scheduling, Email, Chat, Reviews, Maps
- **Authentication:** OAuth 2.1 with PKCE standard
- **Privacy:** GDPR/CCPA compliance with consent management

### API Patterns
- **Server Actions:** Form submissions, business logic
- **Rate Limiting:** Built into @repo/infra
- **Error Handling:** Consistent error responses

## Documentation Structure

### Core Documentation
- **ARCHITECTURE.md** - System architecture overview
- **DEVELOPMENT.md** - Development setup and workflows
- **TESTING.md** - Testing strategy and execution
- **docs/architecture/README.md** - Detailed architecture documentation
- **docs/getting-started/onboarding.md** - Comprehensive developer guide

### AI Context
- **.context/MAP.md** - Semantic concept to file mapping
- **.context/RULES.md** - AI assistant guardrails and conventions
- **CLAUDE.md** - Original AI assistant guide (migrated to RULES.md)

### Decision Records
- **Location:** `docs/adr/` (adaptation from standard root ADRs/)
- **Format:** Numbered ADRs (0001-0009) documenting architectural decisions

## Common Workflows

### Adding UI Component
1. Create in `packages/ui/src/components/ComponentName/`
2. Add tests in `__tests__/ComponentName.test.tsx`
3. Export in `packages/ui/src/index.ts`
4. Run `pnpm validate-ui-exports`

### Adding Feature
1. Create in `packages/features/src/feature/`
2. Add actions, components, types, tests
3. Export from feature index
4. Update feature exports in main index

### Quality Validation
```bash
pnpm lint                  # Code style
pnpm type-check            # TypeScript
pnpm test                  # Tests
pnpm validate-exports      # Package exports
pnpm validate-client [path] # Client config
```

## Security and Performance

### Security
- **Multi-layer:** Infrastructure, application, data layers
- **Input Validation:** Zod schemas for all user inputs
- **Rate Limiting:** Built into middleware
- **Headers:** CSP, security headers configured

### Performance
- **Core Web Vitals:** LCP < 2.5s, INP < 200ms, CLS < 0.1
- **Bundle Optimization:** Code splitting, lazy loading
- **Edge Computing:** Global CDN distribution
- **Monitoring:** Real user metrics collection

## CI/CD Pipeline

### Quality Gates (Blocking)
1. ESLint (affected packages on PRs)
2. TypeScript type checking
3. Package export validation
4. Circular dependency detection
5. Dependency version consistency
6. Full build verification
7. Test coverage

### Turbo Optimization
- **PRs:** Affected packages only via `--filter="...[origin/main]"`
- **Main:** Full pipeline execution

## Known Constraints

### Critical Requirements
- **Node.js:** >=22.0.0 (strictly enforced)
- **pnpm:** 10.29.2 (strictly enforced)
- **No deep imports:** Use public package exports only
- **Cross-client isolation:** Never import between clients

### Common Issues
- TypeScript build errors block CI
- Server-only modules in @repo/infra
- Paired environment variables required
- Workspace sync validation needed

## Getting Help

### Documentation
- **Architecture:** `docs/architecture/README.md`
- **Development:** `docs/getting-started/onboarding.md`
- **Testing:** `docs/testing-strategy.md`
- **Tasks:** `TASKS.md` (implementation backlog)

### Validation Commands
- `pnpm validate-docs` - Documentation standards
- `pnpm knip` - Dead code detection
- `pnpm syncpack:check` - Version consistency

---

*This index provides essential context for AI assistants. For detailed information, refer to the specific documentation files mentioned above.*
