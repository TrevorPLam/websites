### 5.6 LCP, INP, CLS Optimization

**Status:** ✅ Completed

**LCP (Largest Contentful Paint — target: <2.5s):**

```typescript
// sites/*/src/app/layout.tsx
import { Inter, Playfair_Display } from 'next/font/google';

// Font optimization: preload, no FOIT/FOUT
const inter = Inter({
  subsets: ['latin'],
  variable: '--font-inter',
  display: 'swap',
  preload: true,
});

const playfair = Playfair_Display({
  subsets: ['latin'],
  variable: '--font-playfair',
  display: 'swap',
  preload: true,
  weight: ['400', '700'],
});

// In page component: preload LCP image
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${inter.variable} ${playfair.variable}`}>
      <head>
        {/* Preload LCP image (hero image) */}
        <link
          rel="preload"
          as="image"
          href="/hero.avif"
          type="image/avif"
          fetchPriority="high"
        />
        {/* DNS prefetch for third-party resources */}
        <link rel="dns-prefetch" href="https://www.google-analytics.com" />
        <link rel="dns-prefetch" href="https://cdn.sanity.io" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
      </head>
      <body>
        {children}
      </body>
    </html>
  );
}
```

```typescript
// Hero image: priority + explicit dimensions = no CLS, faster LCP
import Image from 'next/image';

export function HeroSection({ backgroundImage }: { backgroundImage: string }) {
  return (
    <section className="relative h-screen">
      <Image
        src={backgroundImage}
        alt="Law office interior showing professional environment"
        fill
        priority // Preloads the image (LCP element)
        fetchPriority="high"
        quality={85}
        sizes="100vw"
        className="object-cover"
      />
    </section>
  );
}
```

**INP (Interaction to Next Paint — target: <200ms):**

```typescript
// Heavy computations: move off main thread via Scheduler
import { startTransition } from 'react';

function SearchResults({ query }: { query: string }) {
  const [results, setResults] = useState<Result[]>([]);

  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;

    // Wrap expensive state update in startTransition
    // This tells React it's non-urgent — keep UI responsive
    startTransition(() => {
      const filtered = allLeads.filter((lead) =>
        lead.name.toLowerCase().includes(value.toLowerCase())
      );
      setResults(filtered);
    });
  };

  return (
    <div>
      <input onChange={handleSearch} aria-label="Search leads" />
      <Suspense fallback={<ResultsSkeleton />}>
        {results.map((r) => <ResultCard key={r.id} result={r} />)}
      </Suspense>
    </div>
  );
}
```

**CLS (Cumulative Layout Shift — target: <0.1):**

```typescript
// ALWAYS declare explicit width/height on images
<Image src={logo} alt="Company logo" width={200} height={60} />

// ALWAYS reserve space for dynamic content
<div className="min-h-[64px]"> {/* Reserve space for dynamic nav */}
  <Suspense fallback={<div className="h-16 w-full bg-transparent" />}>
    <DynamicNav />
  </Suspense>
</div>

// AVOID layout shifts from fonts: use font-display: swap
// (Handled by next/font — see LCP section)

// AVOID layout shifts from ads/embeds: use aspect-ratio
<div className="aspect-video"> {/* 16:9 aspect ratio reserved */}
  <Suspense fallback={<div className="w-full h-full bg-gray-100 rounded" />}>
    <YouTubeEmbed videoId="..." />
  </Suspense>
</div>
```

---
