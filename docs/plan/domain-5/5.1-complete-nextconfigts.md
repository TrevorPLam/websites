### 5.1 Complete `next.config.ts`

**File:** `sites/*/next.config.ts`

```typescript
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  // ============================================================================
  // NEXT.JS 16 CORE
  // ============================================================================

  // Cache Components (PPR stable in Next.js 16) — replaces experimental.ppr
  // See: https://nextjs.org/docs/app/getting-started/cache-components
  cacheComponents: true,

  // React Compiler (stable in Next.js 16, opt-in recommended for safety)
  // Phase 1: annotation mode (opt-in per component)
  // Phase 2: 'all' (global) after audit
  // See Domain 5 §5.5 for rollout strategy
  reactCompiler: {
    compilationMode: 'annotation', // Start with opt-in
  },

  // Turbopack (stable in Next.js 16 — 2-5x faster dev builds)
  turbopack: {
    // Environment variable handling
    resolveAlias: {},
    // Enable for dev; prod uses Webpack by default
  },

  // ============================================================================
  // OUTPUT & DEPLOYMENT
  // ============================================================================

  output: 'standalone', // Required for Docker/Vercel deployments

  // Build Adapters API (Next.js 16 — enables AWS Lambda / Cloudflare Workers)
  // Leave undefined for Vercel (auto-detected); set for self-hosting
  // experimental: { deploymentId: process.env.DEPLOYMENT_ID }

  // ============================================================================
  // IMAGE OPTIMIZATION
  // ============================================================================

  images: {
    // AVIF first (35-50% smaller than WebP), WebP fallback
    formats: ['image/avif', 'image/webp'],

    // Per-tenant CDN domains
    remotePatterns: [
      // Supabase Storage (per-tenant uploads)
      {
        protocol: 'https',
        hostname: '*.supabase.co',
        pathname: '/storage/v1/object/public/**',
      },
      // Sanity CDN
      {
        protocol: 'https',
        hostname: 'cdn.sanity.io',
      },
      // Client logos and assets
      {
        protocol: 'https',
        hostname: '*.youragency.com',
      },
    ],

    // Device sizes for responsive images (matches common breakpoints)
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],

    // Image sizes for layout="fixed" and layout="intrinsic"
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],

    // Minimize layout shift from images (requires explicit width/height)
    minimumCacheTTL: 60 * 60 * 24 * 30, // 30 days

    // Dangerous — only enable if you fully control all image sources
    dangerouslyAllowSVG: false,
  },

  // ============================================================================
  // HEADERS (Supplemental — middleware.ts handles most security headers)
  // ============================================================================

  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          // Cache static assets aggressively
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
      {
        // HTML pages: no cache (SSR/PPR pages must be fresh)
        source: '/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'no-cache, no-store, must-revalidate',
          },
        ],
      },
      {
        // API routes: private, no cache
        source: '/api/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'no-store',
          },
        ],
      },
    ];
  },

  // ============================================================================
  // REDIRECTS (SEO-safe, permanent)
  // ============================================================================

  async redirects() {
    return [
      // www → non-www canonical (configure per site)
      {
        source: '/:path*',
        has: [{ type: 'host', value: 'www.youragency.com' }],
        destination: 'https://youragency.com/:path*',
        permanent: true,
      },
    ];
  },

  // ============================================================================
  // TYPESCRIPT & ESLINT
  // ============================================================================

  typescript: {
    // Always fail on type errors (no silent build failures)
    ignoreBuildErrors: false,
  },

  eslint: {
    // Run ESLint on ALL directories in the monorepo
    dirs: ['src', 'app', 'pages', 'components'],
    ignoreDuringBuilds: false,
  },

  // ============================================================================
  // LOGGING (OpenTelemetry integration — Domain 13)
  // ============================================================================

  logging: {
    fetches: {
      fullUrl: process.env.NODE_ENV === 'development',
    },
  },

  // ============================================================================
  // EXPERIMENTAL (stable in Next.js 16 unless noted)
  // ============================================================================

  experimental: {
    // Optimistic navigation (instant client-side transitions)
    optimisticClientCache: true,

    // Preload DNS for third-party scripts
    optimizePackageImports: ['@repo/ui', '@repo/analytics', 'date-fns', 'lucide-react'],

    // Server Component instrumentation for OpenTelemetry
    instrumentationHook: true,

    // Typed routes (type-safe `<Link href="/...">`)
    typedRoutes: true,
  },

  // ============================================================================
  // WEBPACK (Prod bundle optimization — Turbopack handles dev)
  // ============================================================================

  webpack: (config, { isServer }) => {
    // Exclude server-only packages from client bundle
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
        crypto: false,
      };
    }

    return config;
  },
};

export default nextConfig;
```

---
