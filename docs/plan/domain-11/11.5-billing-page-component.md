### 11.5 Billing Page Component

```typescript
// apps/portal/src/features/billing/ui/BillingPage.tsx
import { createCheckoutSession } from '../model/create-checkout';
import { openBillingPortal } from '../model/open-portal';
import { db } from '@repo/db';
import { headers } from 'next/headers';

const PLANS = [
  {
    id: 'starter',
    name: 'Starter',
    priceId: process.env.STRIPE_STARTER_PRICE_ID!,
    price: 297,
    interval: 'month',
    features: [
      '1 marketing website',
      'Up to 500 leads/month',
      'Email notifications',
      'Basic analytics',
      'SSL + hosting included',
    ],
  },
  {
    id: 'professional',
    name: 'Professional',
    priceId: process.env.STRIPE_PROFESSIONAL_PRICE_ID!,
    price: 597,
    interval: 'month',
    featured: true,
    features: [
      'Up to 5 websites',
      'Unlimited leads',
      'Real-time lead feed',
      'Custom domain',
      'CRM integration',
      'A/B testing',
      'Priority support',
    ],
  },
  {
    id: 'enterprise',
    name: 'Enterprise',
    priceId: process.env.STRIPE_ENTERPRISE_PRICE_ID!,
    price: 1497,
    interval: 'month',
    features: [
      'Unlimited websites',
      'White-label portal',
      'SSO / SAML',
      'SLA guarantee',
      'Dedicated support',
      'Custom integrations',
      'Audit logs (7 years)',
    ],
  },
] as const;

async function getCurrentPlan(tenantId: string) {
  const { data } = await db
    .from('tenants')
    .select('billing_tier, status, stripe_customer_id, stripe_subscription_id')
    .eq('id', tenantId)
    .single();
  return data;
}

export async function BillingPage() {
  const tenantId = (await headers()).get('X-Tenant-Id')!;
  const current = await getCurrentPlan(tenantId);
  const hasSubscription = !!current?.stripe_subscription_id;

  return (
    <main aria-labelledby="billing-heading" className="max-w-5xl mx-auto px-4 py-12">
      <h1 id="billing-heading" className="text-3xl font-bold text-gray-900 mb-2">
        Billing & Plans
      </h1>

      {/* Current status banner */}
      {current?.status === 'trial' && (
        <div role="alert" className="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg text-blue-800">
          <strong>Free trial active.</strong> Subscribe before your trial ends to keep your website live.
        </div>
      )}

      {current?.status === 'suspended' && (
        <div role="alert" className="mb-8 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800">
          <strong>Account suspended.</strong> Update your payment method to restore access.
        </div>
      )}

      {/* Plan cards */}
      <div className="grid md:grid-cols-3 gap-6 mb-12">
        {PLANS.map((plan) => {
          const isCurrent = current?.billing_tier === plan.id;

          return (
            <div
              key={plan.id}
              className={`
                border rounded-xl p-6 flex flex-col
                ${plan.featured ? 'border-primary ring-2 ring-primary' : 'border-gray-200'}
                ${isCurrent ? 'bg-green-50 border-green-500' : 'bg-white'}
              `}
              aria-label={`${plan.name} plan${isCurrent ? ' — current plan' : ''}`}
            >
              {plan.featured && (
                <span className="inline-flex self-start bg-primary text-white text-xs font-semibold px-2.5 py-1 rounded-full mb-4">
                  Most Popular
                </span>
              )}
              {isCurrent && (
                <span className="inline-flex self-start bg-green-500 text-white text-xs font-semibold px-2.5 py-1 rounded-full mb-4">
                  Current Plan
                </span>
              )}

              <h2 className="text-xl font-bold">{plan.name}</h2>
              <p className="mt-1 mb-4">
                <span className="text-4xl font-extrabold">${plan.price}</span>
                <span className="text-gray-500">/{plan.interval}</span>
              </p>

              <ul className="space-y-2 flex-1 mb-6">
                {plan.features.map((feat) => (
                  <li key={feat} className="flex items-start gap-2 text-sm text-gray-700">
                    <span aria-hidden="true" className="text-green-500 mt-0.5">✓</span>
                    {feat}
                  </li>
                ))}
              </ul>

              {isCurrent ? (
                <form action={async () => {
                  'use server';
                  const result = await openBillingPortal({});
                  if (result.success && result.data.portalUrl) {
                    // Note: redirect must happen in a client-side handler or Route Handler
                  }
                }}>
                  <button
                    type="submit"
                    className="w-full border border-gray-300 rounded-lg py-3 font-medium hover:bg-gray-50"
                  >
                    Manage Subscription
                  </button>
                </form>
              ) : (
                <form action={async () => {
                  'use server';
                  await createCheckoutSession({ priceId: plan.priceId });
                }}>
                  <button
                    type="submit"
                    className={`w-full rounded-lg py-3 font-semibold ${
                      plan.featured
                        ? 'bg-primary text-white hover:bg-primary/90'
                        : 'border border-gray-300 hover:bg-gray-50'
                    }`}
                  >
                    {hasSubscription ? 'Switch Plan' : 'Start Free Trial'}
                  </button>
                </form>
              )}
            </div>
          );
        })}
      </div>
    </main>
  );
}
```

---
