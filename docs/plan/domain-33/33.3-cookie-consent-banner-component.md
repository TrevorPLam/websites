### 33.3 Cookie Consent Banner Component

**File:** `packages/ui/src/privacy/CookieBanner.tsx`

```typescript
'use client';

import { useState, useTransition } from 'react';
import {
  acceptAllCookies,
  rejectNonEssentialCookies,
  saveCustomConsent,
} from '@repo/privacy/consent';

interface CookieBannerProps {
  show: boolean;
  businessName: string;
  privacyPolicyUrl: string;
}

export function CookieBanner({ show, businessName, privacyPolicyUrl }: CookieBannerProps) {
  const [visible, setVisible] = useState(show);
  const [showCustomize, setShowCustomize] = useState(false);
  const [analytics, setAnalytics] = useState(true);
  const [marketing, setMarketing] = useState(false);
  const [isPending, startTransition] = useTransition();

  if (!visible) return null;

  const handleAcceptAll = () => {
    startTransition(async () => {
      await acceptAllCookies();
      setVisible(false);
      // Dispatch consent update event for GA Consent Mode
      window.dispatchEvent(new CustomEvent('consentUpdated', {
        detail: { analytics: true, marketing: true },
      }));
    });
  };

  const handleRejectAll = () => {
    startTransition(async () => {
      await rejectNonEssentialCookies();
      setVisible(false);
      window.dispatchEvent(new CustomEvent('consentUpdated', {
        detail: { analytics: false, marketing: false },
      }));
    });
  };

  const handleSaveCustom = () => {
    startTransition(async () => {
      await saveCustomConsent({ analytics, marketing });
      setVisible(false);
      window.dispatchEvent(new CustomEvent('consentUpdated', {
        detail: { analytics, marketing },
      }));
    });
  };

  return (
    <div
      role="dialog"
      aria-label="Cookie consent"
      aria-modal="false"
      className="fixed bottom-0 left-0 right-0 z-50 p-4 sm:p-6"
    >
      <div className="max-w-2xl mx-auto bg-white border border-gray-200 rounded-2xl shadow-xl p-5 sm:p-6">
        {!showCustomize ? (
          <>
            <h2 className="text-base font-bold text-gray-900 mb-2">
              {businessName} uses cookies
            </h2>
            <p className="text-sm text-gray-600 mb-4">
              We use essential cookies to make our site work. With your consent, we may also use
              analytics cookies to understand how visitors use the site.{' '}
              <a href={privacyPolicyUrl} className="text-primary underline" target="_blank" rel="noopener noreferrer">
                Privacy Policy
              </a>
            </p>

            <div className="flex flex-col sm:flex-row gap-3">
              <button
                type="button"
                onClick={handleAcceptAll}
                disabled={isPending}
                className="flex-1 py-2.5 bg-primary text-white rounded-xl text-sm font-semibold hover:opacity-90 transition-opacity disabled:opacity-50"
              >
                Accept All
              </button>
              <button
                type="button"
                onClick={handleRejectAll}
                disabled={isPending}
                className="flex-1 py-2.5 border border-gray-300 text-gray-700 rounded-xl text-sm font-semibold hover:bg-gray-50 transition-colors disabled:opacity-50"
              >
                Reject Non-Essential
              </button>
              <button
                type="button"
                onClick={() => setShowCustomize(true)}
                disabled={isPending}
                className="flex-1 py-2.5 text-gray-500 rounded-xl text-sm hover:text-gray-700 transition-colors disabled:opacity-50"
              >
                Customize
              </button>
            </div>
          </>
        ) : (
          <>
            <h2 className="text-base font-bold text-gray-900 mb-4">Cookie Preferences</h2>

            {[
              { label: 'Essential', description: 'Required for the site to function. Cannot be disabled.', enabled: true, locked: true, onChange: () => {} },
              { label: 'Analytics', description: 'Helps us understand how visitors use the site (anonymized).', enabled: analytics, locked: false, onChange: setAnalytics },
              { label: 'Marketing', description: 'Used to show relevant ads on third-party sites.', enabled: marketing, locked: false, onChange: setMarketing },
            ].map((category) => (
              <div key={category.label} className="flex items-start justify-between mb-4">
                <div className="flex-1 mr-4">
                  <p className="text-sm font-semibold text-gray-900">{category.label}</p>
                  <p className="text-xs text-gray-500 mt-0.5">{category.description}</p>
                </div>
                <button
                  type="button"
                  role="switch"
                  aria-checked={category.enabled}
                  aria-label={`${category.label} cookies ${category.enabled ? 'enabled' : 'disabled'}`}
                  disabled={category.locked}
                  onClick={() => !category.locked && category.onChange(!category.enabled)}
                  className={`
                    relative inline-flex h-6 w-11 items-center rounded-full transition-colors flex-shrink-0
                    ${category.enabled ? 'bg-primary' : 'bg-gray-300'}
                    ${category.locked ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
                  `}
                >
                  <span
                    className={`
                      inline-block h-4 w-4 transform rounded-full bg-white transition-transform
                      ${category.enabled ? 'translate-x-6' : 'translate-x-1'}
                    `}
                  />
                </button>
              </div>
            ))}

            <div className="flex gap-3 mt-4">
              <button
                type="button"
                onClick={handleSaveCustom}
                disabled={isPending}
                className="flex-1 py-2.5 bg-primary text-white rounded-xl text-sm font-semibold hover:opacity-90 disabled:opacity-50"
              >
                Save Preferences
              </button>
              <button
                type="button"
                onClick={() => setShowCustomize(false)}
                disabled={isPending}
                className="py-2.5 px-4 text-gray-500 text-sm hover:text-gray-700"
              >
                Back
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );
}
```

---
