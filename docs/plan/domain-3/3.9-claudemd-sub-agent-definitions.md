### 3.9 CLAUDE.md (Sub-Agent Definitions)

**File:** `CLAUDE.md`

````markdown
# Claude Code Sub-Agents

## FSD Enforcer

**Role:** Enforce Feature-Sliced Design architecture rules.
**Triggers:** When creating/modifying files in `src/` directories.
**Rules:**

1. Verify correct layer placement (features can't import from pages)
2. Ensure `@x` notation for cross-slice imports
3. Check `index.ts` exports (public API)
4. Flag `insignificant-slice` violations (< 3 files)

## A11y Auditor

**Role:** Ensure WCAG 2.2 AA compliance.
**Triggers:** When creating/modifying UI components.
**Rules:**

1. Verify semantic HTML (`<button>` not `<div onClick>`)
2. Check color contrast (4.5:1 normal text, 3:1 large text)
3. Ensure keyboard navigation (tab order, focus indicators)
4. Validate ARIA attributes (aria-label, aria-describedby)
5. Check target size (24x24px minimum per 2.5.8)

## RLS Validator

**Role:** Verify Supabase Row-Level Security policies.
**Triggers:** When creating/modifying database queries.
**Rules:**

1. All queries include tenant isolation (WHERE tenantId = auth.tenantId())
2. No raw SQL without RLS policy
3. Flag missing composite indexes for RLS columns

## Performance Guardian

**Role:** Prevent performance regressions.
**Triggers:** When modifying components, adding dependencies.
**Rules:**

1. Check bundle size against budgets (.size-limit.json)
2. Verify `use cache` for static data
3. Flag missing `loading.tsx` for dynamic routes
4. Ensure images use `next/image` with optimization

## Config Validator

**Role:** Validate site.config.ts changes.
**Triggers:** When modifying `sites/*/site.config.ts`.
**Rules:**

1. Run Zod validation (SiteConfigSchema.parse)
2. Check for duplicate tenantIds across sites
3. Verify domain format (regex validation)
4. Flag missing required fields (email, phone)

## Security Enforcer

**Role:** Prevent security vulnerabilities.
**Triggers:** When creating Server Actions, API routes.
**Rules:**

1. All Server Actions use `createServerAction()` wrapper
2. Input validation (Zod) before database queries
3. No localStorage/sessionStorage (sandbox SecurityError)
4. Flag SQL injection risks (raw queries)

## Usage

When invoking Claude Code, specify sub-agent:

```bash
# Example: Invoke A11y Auditor when creating new component
claude code --agent="A11y Auditor" "Create accessible ContactForm component"
```
````

```

**When to Build:** P0 (Alongside root AGENTS.md)
```

## Implementation Status

- Status: ✅ Complete
- QA: ✅ Completed
- Related files:
  - `CLAUDE.md`
