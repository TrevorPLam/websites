### 3.7 Per-Package AGENTS.md Stubs

**Template:** `packages/[package-name]/AGENTS.md`

```markdown
# [Package Name] — AI Agent Context

## Purpose

[1-2 sentences: what this package does]

## Key Entry Points

- `src/index.ts` — [Public API exports]
- `src/[main-feature]/` — [Primary feature slice]

## FSD Layer Structure

- `entities/` — [Domain models]
- `features/` — [Business logic features]
- `shared/` — [Utilities and infrastructure]

## Dependencies

- **External:** [List key npm packages]
- **Internal:** [List @repo/* dependencies]

## Common Tasks

- **Add new component:** Create slice in `src/primitives/[name]/`, export via `index.ts`
- **Modify styling:** Update Tailwind config in `tailwind.config.ts`
- **Run tests:** `pnpm test`

## TODOs

- [ ] [Any outstanding work]

## Last Updated

[Date] by [Human/AI Agent]
```

**Example:** `packages/ui/AGENTS.md` (40 lines max)

````markdown
# UI Package Agent Context

**Package:** `@repo/ui`
**Purpose:** Design system + marketing components
**Architecture:** Feature-Sliced Design v2.1

## Structure

src/
├── shared/ # UI primitives (Button, Card, Input)
├── entities/ # Business concepts (Lead, Tenant, User)
├── features/ # User interactions (LeadForm, ABTest, Booking)
└── widgets/ # Layouts (Header, Footer, CookieBanner)

## FSD Rules (Enforced by Steiger)

1. **Unidirectional**: Import only from lower layers
2. **No same-layer imports**: `features/a` ❌ `features/b`
3. **Cross-slice via @x**: `entities/order` → `entities/user/@x` ✅

## Component Requirements

- **Accessibility**: WCAG 2.2 AA (see `/docs/wcag-checklist.md`)
- **Responsive**: Mobile-first (Tailwind breakpoints)
- **Dark mode**: Via `data-brand` attribute
- **Storybook**: All components must have stories

## Commands

```bash
pnpm build                    # Compile TypeScript
pnpm test                     # Vitest unit tests
pnpm lint:fsd                 # Steiger FSD validation
pnpm storybook                # Launch Storybook
```
````

## Adding New Component

1. Choose correct layer (see FSD rules)
2. Create folder with `ui/`, `model/`, `index.ts`
3. Add Storybook story (`.stories.tsx`)
4. Add unit tests (co-located `.test.tsx`)
5. Export via `index.ts` (public API only)

````

**Example:** `packages/auth/AGENTS.md`

```markdown
# Auth Package Agent Context

**Package:** `@repo/auth`
**Purpose:** Multi-tenant authentication utilities
**Dependencies:** Supabase Auth

## Structure
src/
├── server.ts # Server-only auth helpers (import 'server-only')
├── client.ts # Client component hooks
└── middleware.ts # Auth middleware helpers

## Multi-Tenant Auth Flow

1. User authenticates via Supabase Auth
2. Session includes `user_id`
3. Middleware resolves `tenant_id` from domain/path
4. RLS policies enforce `tenant_id` + `user_id` checks

## Server Actions Security

**ALWAYS use `createServerAction()` wrapper:**

```typescript
import { createServerAction } from '@repo/server-actions';

export const updateProfile = createServerAction(
  async (input: ProfileInput, context) => {
    // context.userId automatically injected
    // context.tenantId automatically injected
    // Input validated via Zod
  },
  {
    input: ProfileInputSchema,
    requireAuth: true,
    requireTenantMembership: true,
  }
);
````

**NEVER** bypass middleware checks (CVE-2025-29927 vulnerability).

## RLS Isolation Tests

All auth functions must have corresponding RLS tests in `/e2e/tests/multi-tenant.spec.ts`.

````

**Example:** `packages/database/AGENTS.md`

```markdown
# Database Package Agent Context

**Package:** `@repo/database`
**Purpose:** Supabase client + types + migrations
**Database:** PostgreSQL 15 via Supabase

## Structure
src/
├── client.ts # Supabase client factory
├── types.ts # Generated types (DO NOT EDIT MANUALLY)
├── migrations/ # SQL migrations (timestamped)
│ ├── 001_initial.sql
│ ├── 002_add_rls.sql
│ └── ...
└── seed.ts # Development seed data

## Migration Safety Rules

1. **Every migration has `-- Down` block** for rollback
2. **No destructive changes without data migration plan**
3. **Test migration on staging first**
4. **RLS policies added in same migration as table**

## RLS Policy Pattern

```sql
-- Example: leads table
CREATE POLICY "Tenants can only see their own leads"
ON leads FOR SELECT
USING (tenant_id = auth.jwt() ->> 'tenant_id');

CREATE POLICY "Tenants can only insert leads for themselves"
ON leads FOR INSERT
WITH CHECK (tenant_id = auth.jwt() ->> 'tenant_id');
````

**ALWAYS include composite index:**

```sql
CREATE INDEX idx_leads_tenant_id_created_at
ON leads (tenant_id, created_at DESC);
```

## Type Generation

```bash
pnpm generate:types  # Regenerates types.ts from live DB schema
```

**DO NOT** commit `types.ts` changes without corresponding migration.

````

**Example:** `packages/lead-capture/AGENTS.md`

```markdown
# Lead Capture — AI Agent Context

## Purpose

Handles lead capture workflows: form submission → validation → scoring → CRM routing → notifications.

## Key Entry Points

- `src/index.ts` — Exports `captureLead()`, `scoreLead()`, `routeLead()`
- `src/features/lead-form/` — React form component
- `src/features/lead-scoring/` — Lead scoring engine

## FSD Layer Structure

- `features/lead-form/` — Form UI and submission logic
- `features/lead-scoring/` — Scoring algorithm
- `features/lead-routing/` — CRM integration routing
- `entities/lead/` — Lead domain model (types, schema, API)
- `shared/lib/` — Utilities (validation, formatting)

## Dependencies

- **External:** `zod`, `react-hook-form`, `@repo/db`, `@repo/email`
- **Internal:** `@repo/config-schema` (LeadScoringSchema)

## Common Tasks

- **Modify scoring weights:** Edit `src/features/lead-scoring/model/scoreLeadLogic.ts`
- **Add new CRM provider:** Add case in `src/features/lead-routing/api/routeToCRM.ts`
- **Test scoring:** `pnpm test src/features/lead-scoring/model/scoreLeadLogic.test.ts`

## TODOs

- [ ] Add Salesforce CRM routing support (P2)

## Last Updated

2026-02-23 by Claude Code
````

**Why per-package AGENTS.md:** AI agents can navigate to any package and immediately understand:

- What it does
- Where to find key code
- How to make common changes

**When to Build:** P0 (All 15+ AGENTS.md files created during initial setup)
