### 2.3 Config Validation CI Step

**File:** `.github/workflows/ci.yml` (excerpt)

```yaml
jobs:
  validate-configs:
    name: Validate Site Configs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 10

      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Validate all site.config.ts files
        run: pnpm turbo run validate:configs

      - name: Check for config conflicts (duplicate tenantIds)
        run: |
          node scripts/check-config-conflicts.js
```

**Validation Script:**

**File:** `packages/config-schema/src/validate-all.ts`

```typescript
import { glob } from 'glob';
import { validateSiteConfig } from './schema';
import path from 'path';

async function validateAllConfigs() {
  const configFiles = await glob('sites/*/site.config.ts', {
    cwd: process.cwd(),
    absolute: true,
  });

  let hasErrors = false;

  for (const file of configFiles) {
    try {
      const config = await import(file);
      validateSiteConfig(config.default);
      console.log(`✅ ${path.basename(path.dirname(file))}: Valid`);
    } catch (error) {
      console.error(`❌ ${path.basename(path.dirname(file))}: Invalid`);
      console.error(error);
      hasErrors = true;
    }
  }

  if (hasErrors) {
    process.exit(1);
  }
}

validateAllConfigs();
```

**Conflict Detection Script:**

**File:** `scripts/check-config-conflicts.js`

```javascript
// Prevents duplicate tenantIds across sites
const fs = require('fs');
const path = require('path');
const glob = require('glob');

const configPaths = glob.sync('sites/*/site.config.ts');
const tenantIds = new Set();
const duplicates = [];

configPaths.forEach((configPath) => {
  const config = require(path.resolve(configPath)).default;
  const tenantId = config.identity.tenantId;

  if (tenantIds.has(tenantId)) {
    duplicates.push({ configPath, tenantId });
  } else {
    tenantIds.add(tenantId);
  }
});

if (duplicates.length > 0) {
  console.error('❌ Duplicate tenantIds found:');
  duplicates.forEach(({ configPath, tenantId }) => {
    console.error(`  - ${configPath}: ${tenantId}`);
  });
  process.exit(1);
}

console.log(`✅ All ${configPaths.length} site configs valid (no duplicate tenantIds)`);
```

**When to Build:** P0 (Prevents invalid configs from reaching production)
