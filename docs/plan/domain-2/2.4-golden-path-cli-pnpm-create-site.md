### 2.4 Golden Path CLI: `pnpm create-site`

**File:** `packages/create-site/src/cli.ts` (or `scripts/create-site.ts`)

```typescript
#!/usr/bin/env node
import { input, select, confirm } from '@inquirer/prompts';
import { SiteConfigSchema, validateSiteConfigSafe } from '@repo/config-schema';
import fs from 'fs/promises';
import path from 'path';
import { execSync } from 'child_process';
import { v4 as uuidv4 } from 'uuid';
import prompts from 'prompts';
import chalk from 'chalk';

async function createSite() {
  console.log('üöÄ Create New Client Site\n');

  // Step 1: Basic Identity
  const tenantSlug = await input({
    message: 'Tenant slug (lowercase, alphanumeric + hyphens):',
    validate: (value) => /^[a-z0-9-]+$/.test(value) || 'Invalid format',
  });

  const siteName = await input({
    message: 'Site name (display):',
    validate: (value) => value.length > 0 || 'Site name is required',
  });

  const businessName = await input({
    message: 'Legal business name:',
    validate: (value) => value.length > 0 || 'Required',
  });

  const contactEmail = await input({
    message: 'Contact email:',
    validate: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) || 'Invalid email',
  });

  const contactPhone = await input({
    message: 'Contact phone (E.164 format, e.g., +14155552671):',
    validate: (value) => /^\+?[1-9]\d{1,14}$/.test(value) || 'Invalid phone number',
  });

  const businessType = await select({
    message: 'Business type:',
    choices: [
      { value: 'LocalBusiness', name: 'Local Business' },
      { value: 'Attorney', name: 'Law Firm' },
      { value: 'Restaurant', name: 'Restaurant' },
      { value: 'HomeAndConstructionBusiness', name: 'Home Services (HVAC, Plumbing, etc.)' },
      { value: 'MedicalBusiness', name: 'Medical Practice' },
      { value: 'ProfessionalService', name: 'Professional Service' },
      { value: 'Store', name: 'Store' },
    ],
  });

  // Step 2: Domain Strategy
  const domainStrategy = await select({
    message: 'Domain strategy:',
    choices: [
      { value: 'subdomain', name: `Subdomain (${tenantSlug}.platform.com)` },
      { value: 'custom', name: 'Custom domain (clientdomain.com)' },
    ],
  });

  let customDomain: string | undefined;
  if (domainStrategy === 'custom') {
    customDomain = await input({
      message: 'Custom domain:',
      validate: (value) => /^[a-z0-9.-]+\.[a-z]{2,}$/.test(value) || 'Invalid domain',
    });
  }

  // Step 3: Billing Tier
  const tier = await select({
    message: 'Billing tier:',
    choices: [
      { value: 'free', name: 'Free (100 requests/10s, 1000 leads/mo)' },
      { value: 'starter', name: 'Starter (500 requests/10s, 5000 leads/mo)' },
      { value: 'professional', name: 'Professional (1000 requests/10s, unlimited leads)' },
      { value: 'enterprise', name: 'Enterprise (custom limits)' },
    ],
  });

  const primaryColor = await input({
    message: 'Primary Brand Color (hex):',
    default: '#3b82f6',
    validate: (value) => /^#[0-9A-Fa-f]{6}$/.test(value) || 'Must be hex color',
  });

  // Check for conflicts
  const sitePath = path.join(process.cwd(), 'sites', tenantSlug);
  const exists = await fs
    .access(sitePath)
    .then(() => true)
    .catch(() => false);

  if (exists) {
    console.error(`‚ùå Site "${tenantSlug}" already exists`);
    process.exit(1);
  }

  // Generate tenantId (UUID)
  const tenantId = uuidv4();
  console.log(`\nüìã Generated tenantId: ${tenantId}`);

  // Check database
  // (Implementation depends on database client)

  // Step 4: Confirm
  const confirmed = await confirm({
    message: `Create site for ${businessName} (${tenantSlug})?`,
    default: true,
  });

  if (!confirmed) {
    console.log('Cancelled');
    process.exit(0);
  }

  // Step 5: Generate Config Template
  const config = {
    version: '1.0',
    identity: {
      tenantId,
      tenantSlug,
      siteName,
      businessName,
      legalBusinessName: businessName,
      domain: {
        primary: domainStrategy === 'custom' ? customDomain! : `${tenantSlug}.platform.com`,
        subdomain: tenantSlug,
        customDomain: domainStrategy === 'custom' ? customDomain : undefined,
        customDomains: domainStrategy === 'custom' ? [customDomain!] : undefined,
        pathBased: false,
      },
      contact: {
        email: contactEmail,
        phone: contactPhone,
        address: {
          street: '123 Main St', // TODO: Update with actual address
          city: 'Dallas',
          state: 'TX',
          zip: '75201',
          country: 'US',
        },
      },
    },
    theme: {
      colorPalette: {
        primary: primaryColor,
        secondary: '#64748b',
        accent: '#f59e0b',
        neutral: '#6b7280',
        background: '#ffffff',
        foreground: '#1f2937',
      },
      typography: {
        fontFamily: {
          heading: 'Inter, sans-serif',
          body: 'Inter, sans-serif',
        },
        scale: {
          base: 16,
          ratio: 1.25,
        },
      },
      spacing: {
        base: 4,
      },
      borderRadius: {
        sm: '0.25rem',
        md: '0.5rem',
        lg: '0.75rem',
        xl: '1rem',
        full: '9999px',
      },
      logo: {
        light: `https://placehold.co/200x50/png?text=${siteName}`,
        dark: `https://placehold.co/200x50/png?text=${siteName}`,
        favicon: `https://placehold.co/32x32/png`,
      },
    },
    businessInfo: {
      address: {
        street: '123 Main St',
        city: 'Dallas',
        state: 'TX',
        zip: '75201',
        country: 'US',
      },
      phone: contactPhone,
      email: contactEmail,
      type: businessType,
      category: 'TODO: Add business category',
      description: 'TODO: Add business description (50-500 chars)',
      hoursOfOperation: [
        { dayOfWeek: 'Monday', opens: '09:00', closes: '17:00' },
        { dayOfWeek: 'Tuesday', opens: '09:00', closes: '17:00' },
        { dayOfWeek: 'Wednesday', opens: '09:00', closes: '17:00' },
        { dayOfWeek: 'Thursday', opens: '09:00', closes: '17:00' },
        { dayOfWeek: 'Friday', opens: '09:00', closes: '17:00' },
      ],
    },
    seo: {
      title: `${siteName} | TODO: Add tagline`,
      titleTemplate: `%s | ${siteName}`,
      description: 'TODO: Add SEO description (50-160 chars)',
      canonicalBase:
        domainStrategy === 'custom'
          ? `https://${customDomain}`
          : `https://${tenantSlug}.platform.com`,
      noindex: false,
      structuredData: {
        enabled: true,
        enableLocalBusiness: true,
        enableBreadcrumbs: true,
        enableFAQPage: false,
        enableArticle: false,
      },
      aiControlPreferences: {
        allowCrawling: true,
        llmsTxt: true,
        aiContextJson: true,
      },
    },
    billing: {
      tier: tier as any,
      rateLimit: tier === 'free' ? 100 : tier === 'starter' ? 500 : 1000,
      monthlyLeads: tier === 'free' ? 1000 : tier === 'starter' ? 5000 : 999999,
      storageGB: 10,
      customDomains: 1,
      status: 'trial',
      trialEndsAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 days
    },
    cookieConsent: {
      enabled: true,
      mode: 'native',
      bannerPosition: 'bottom',
      googleConsentMode: true,
      enableGoogleConsentModeV2: true,
      gcmEnabled: true,
      categories: {
        necessary: true,
        analytics: false,
        marketing: false,
        preferences: false,
      },
      defaultConsent: {
        analytics_storage: 'denied',
        ad_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied',
      },
    },
    i18n: {
      defaultLocale: 'en-US',
      locales: ['en-US'],
      detectFromBrowser: true,
      detectFromDomain: false,
      multiLocation: false,
    },
    compliance: {
      wcagLevel: 'AA',
      wcag: {
        level: 'AA',
        version: '2.2',
        targetLevel: 'AA',
        enableAccessibilityStatement: true,
      },
      gdprEnabled: true,
      gdpr: {
        enabled: true,
        applicable: false,
        dataRetentionDays: 730,
        dpaRequired: false,
        dpaAccepted: false,
      },
      ccpaEnabled: false,
      dpaRequired: false,
      postQuantumReady: false,
      pqc: {
        enablePostQuantumCrypto: false,
        migrationPhase: 'rsa',
      },
    },
    features: {
      enableABTesting: false,
      enableCookieConsent: true,
      enableLeadForms: true,
      enableBooking: false,
      enableChat: false,
      enableBlog: true,
      enableEcommerce: false,
      enableMultiLocation: false,
      enableForms: {
        contactForm: true,
        newsletterSignup: false,
      },
    },
    leadScoring: {
      enabled: true,
      weights: {
        formSubmission: 20,
        phoneClick: 30,
        emailClick: 20,
        pageView: 5,
        timeOnSite: 1,
      },
      qualifiedScore: 100,
      qualificationThreshold: 50,
      routing: {
        crmEnabled: true,
        crm: true,
        notifyEmail: contactEmail,
        ownerEmail: contactEmail,
        notifyOnQualified: true,
      },
    },
    notifications: {
      email: {
        enabled: true,
        newLeadNotification: true,
        qualifiedLeadNotification: true,
        bookingConfirmation: true,
        recipients: [contactEmail],
      },
    },
    abTesting: [],
    abTests: [],
    createdAt: new Date(),
    updatedAt: new Date(),
    createdBy: contactEmail,
  };

  // Validate generated config
  try {
    SiteConfigSchema.parse(config);
  } catch (error) {
    console.error('‚ùå Generated config is invalid:', error);
    process.exit(1);
  }

  // Step 6: Create Directory & Files
  await fs.mkdir(sitePath, { recursive: true });
  await fs.mkdir(path.join(sitePath, 'content'), { recursive: true });
  await fs.mkdir(path.join(sitePath, 'public'), { recursive: true });
  await fs.mkdir(path.join(sitePath, 'src'), { recursive: true });
  await fs.mkdir(path.join(sitePath, 'src/app'), { recursive: true });

  // Write site.config.ts
  const configContent = `import { SiteConfig } from '@repo/config-schema';

const config: SiteConfig = ${JSON.stringify(config, null, 2)};

export default config;
`;

  await fs.writeFile(path.join(sitePath, 'site.config.ts'), configContent, 'utf-8');

  // Write package.json
  const packageJson = {
    name: `@sites/${tenantSlug}`,
    version: '0.0.0',
    private: true,
    dependencies: {
      '@repo/config-schema': 'workspace:*',
    },
  };

  await fs.writeFile(
    path.join(sitePath, 'package.json'),
    JSON.stringify(packageJson, null, 2),
    'utf-8'
  );

  // Write README.md
  const readmeContent = `# ${siteName}

**Tenant Slug:** \`${tenantSlug}\`
**Tenant ID:** \`${tenantId}\`
**Business Type:** ${businessType}
**Billing Tier:** ${tier}

## Domain

${
  domainStrategy === 'subdomain'
    ? `- Subdomain: https://${tenantSlug}.platform.com`
    : `- Custom Domain: https://${customDomain}`
}

## Quick Links

- [Client Portal](https://portal.platform.com/${tenantSlug})
- [Admin Dashboard](https://admin.platform.com/tenants/${tenantSlug})

## Local Development

\`\`\`bash
pnpm dev --filter=@repo/web
# Visit: http://localhost:3000/${tenantSlug}
\`\`\`

## Building

\`\`\`bash
pnpm build --filter=${tenantSlug}
\`\`\`

## Deployment

Automatic via Vercel when merged to \`main\`.
`;

  await fs.writeFile(path.join(sitePath, 'README.md'), readmeContent, 'utf-8');

  // Write AGENTS.md
  const agentsMdContent = `# ${siteName} ‚Äî AI Agent Context

## Overview
Client site for ${siteName} (${businessType}).

**Tenant ID:** \`${tenantId}\`
**Subdomain:** \`${tenantSlug}.platform.com\`
${customDomain ? `**Custom Domain:** \`${customDomain}\`` : ''}

## Key Files
- \`site.config.ts\` ‚Äî Complete site configuration (single source of truth)
- \`src/app/\` ‚Äî Next.js 16 App Router pages
- \`src/components/\` ‚Äî Site-specific components (overrides from @repo/ui)

## TODOs for Client Onboarding
- [ ] Update \`site.config.ts\` business description
- [ ] Replace placeholder logo URLs with actual logos
- [ ] Add Sanity project ID to \`cms.sanity.projectId\`
- [ ] Configure custom domain in Vercel (if applicable)
- [ ] Update business hours in \`businessInfo.hoursOfOperation\`
- [ ] Add Google Analytics / GTM IDs (if client provides)

## Running Locally
\`\`\`bash
pnpm dev --filter=${tenantSlug}
\`\`\`

## Building
\`\`\`bash
pnpm build --filter=${tenantSlug}
\`\`\`

## Deployment
Automatic via Vercel when merged to \`main\`.
`;

  await fs.writeFile(path.join(sitePath, 'AGENTS.md'), agentsMdContent, 'utf-8');

  // Step 7: Database Registration (atomic transaction)
  const shouldRegisterDB = await confirm({
    message: 'Register tenant in database?',
    default: true,
  });

  if (shouldRegisterDB) {
    console.log('üîÑ Registering tenant in database...');
    try {
      execSync(`pnpm tsx scripts/db/register-tenant.ts ${tenantId} ${tenantSlug}`, {
        stdio: 'inherit',
      });
      console.log('‚úÖ Tenant registered in database');
    } catch (error) {
      console.error('‚ùå Database registration failed. Rolling back...');
      await fs.rm(sitePath, { recursive: true, force: true });
      process.exit(1);
    }
  }

  // Step 8: Install dependencies
  console.log('üì¶ Installing dependencies...');
  execSync('pnpm install', { stdio: 'inherit' });

  // Success
  console.log(`\n‚úÖ Site "${tenantSlug}" created successfully!`);
  console.log(`\nüìÇ Location: ${sitePath}`);
  console.log(`\nüåê URL: https://${tenantSlug}.platform.com`);
  if (customDomain) console.log(`üîó Custom Domain: https://${customDomain}`);
  console.log(`\nüî• Next steps:`);
  console.log(`   1. cd sites/${tenantSlug}`);
  console.log(`   2. Update TODOs in site.config.ts`);
  console.log(`   3. Replace placeholder logo URLs`);
  console.log(`   4. Add Sanity project ID`);
  console.log(`   5. Run: pnpm dev --filter=${tenantSlug}`);
  console.log(`   6. Commit and push to deploy\n`);
}

createSite().catch(console.error);
```

**Package.json script:**

```json
{
  "scripts": {
    "create-site": "tsx packages/cli/src/create-site.ts"
  }
}
```

**Usage:**

```bash
pnpm create-site
```

**Why Golden Path CLI:**

- Conflict detection: Prevents duplicate tenant slugs
- Atomic registration: Database + filesystem in single transaction (rollback on failure)
- Validation: Ensures config is valid before writing files
- AGENTS.md update: Prevents context staleness (critical for AI agents)
- Guided prompts ensure minimal user error

**When to Build:** P0.5 (After schema and database are ready)
