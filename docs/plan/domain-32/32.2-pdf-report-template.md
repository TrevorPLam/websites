### 32.2 PDF Report Template

**File:** `packages/reports/src/templates/WeeklyReport.tsx`

```typescript
import {
  Document, Page, Text, View, StyleSheet, Font, Svg,
  Line, Rect, G, Image,
} from '@react-pdf/renderer';

// ============================================================================
// WEEKLY LEAD REPORT — @react-pdf/renderer
// Runs server-side in a QStash job (pure Node, no browser required)
// ============================================================================

Font.register({
  family: 'Inter',
  fonts: [
    { src: 'https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiJ-Ek-_EeA.woff', fontWeight: 400 },
    { src: 'https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuI6fAZ9hiJ-Ek-_EeA.woff', fontWeight: 700 },
    { src: 'https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hiJ-Ek-_EeA.woff', fontWeight: 800 },
  ],
});

interface WeeklyReportProps {
  businessName: string;
  logoUrl?: string;
  primaryColor: string;
  reportPeriod: string;         // e.g. "Feb 17 – Feb 23, 2026"
  stats: {
    totalLeads: number;
    qualifiedLeads: number;     // score ≥ 70
    warmLeads: number;          // score 40–69
    coldLeads: number;          // score < 40
    totalBookings: number;
    completedBookings: number;
    newThisWeek: number;        // vs prior week
    avgScore: number;
  };
  topLeads: Array<{
    name: string;
    email: string;
    score: number;
    source: string;
    date: string;
  }>;
  sourceBreakdown: Array<{
    source: string;
    count: number;
    percentage: number;
  }>;
  weeklyTrend: Array<{
    day: string;    // "Mon", "Tue", etc.
    count: number;
  }>;
}

const styles = StyleSheet.create({
  page: {
    fontFamily: 'Inter',
    backgroundColor: '#ffffff',
    paddingTop: 0,
    paddingBottom: 48,
    paddingHorizontal: 0,
    fontSize: 10,
    color: '#111827',
  },
  header: {
    paddingVertical: 28,
    paddingHorizontal: 48,
    marginBottom: 24,
  },
  headerTop: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    marginBottom: 8,
  },
  businessName: {
    fontSize: 18,
    fontWeight: 800,
    color: '#ffffff',
  },
  reportTitle: {
    fontSize: 11,
    color: 'rgba(255,255,255,0.8)',
    marginTop: 2,
  },
  period: {
    fontSize: 10,
    color: 'rgba(255,255,255,0.7)',
    marginTop: 2,
  },
  section: {
    paddingHorizontal: 48,
    marginBottom: 28,
  },
  sectionTitle: {
    fontSize: 11,
    fontWeight: 700,
    color: '#6b7280',
    textTransform: 'uppercase',
    letterSpacing: 1,
    marginBottom: 12,
  },
  statsGrid: {
    flexDirection: 'row',
    gap: 12,
  },
  statCard: {
    flex: 1,
    backgroundColor: '#f9fafb',
    borderRadius: 8,
    padding: 14,
    borderWidth: 1,
    borderColor: '#e5e7eb',
  },
  statValue: {
    fontSize: 28,
    fontWeight: 800,
    color: '#111827',
    lineHeight: 1,
  },
  statLabel: {
    fontSize: 9,
    color: '#6b7280',
    marginTop: 4,
    fontWeight: 400,
  },
  statDelta: {
    fontSize: 9,
    marginTop: 6,
    fontWeight: 700,
  },
  table: {
    borderWidth: 1,
    borderColor: '#e5e7eb',
    borderRadius: 8,
    overflow: 'hidden',
  },
  tableHeader: {
    flexDirection: 'row',
    backgroundColor: '#f3f4f6',
    paddingVertical: 8,
    paddingHorizontal: 14,
  },
  tableHeaderCell: {
    fontSize: 9,
    fontWeight: 700,
    color: '#6b7280',
    textTransform: 'uppercase',
    letterSpacing: 0.5,
  },
  tableRow: {
    flexDirection: 'row',
    paddingVertical: 9,
    paddingHorizontal: 14,
    borderTopWidth: 1,
    borderColor: '#f3f4f6',
  },
  tableCell: {
    fontSize: 9.5,
    color: '#374151',
  },
  scoreChip: {
    paddingHorizontal: 6,
    paddingVertical: 2,
    borderRadius: 4,
    fontSize: 9,
    fontWeight: 700,
  },
  footer: {
    position: 'absolute',
    bottom: 24,
    left: 48,
    right: 48,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    borderTopWidth: 1,
    borderColor: '#e5e7eb',
    paddingTop: 12,
  },
  footerText: {
    fontSize: 8,
    color: '#9ca3af',
  },
});

const scoreColor = (score: number): string => {
  if (score >= 70) return '#16a34a';
  if (score >= 40) return '#ca8a04';
  return '#6b7280';
};

const scoreBackground = (score: number): string => {
  if (score >= 70) return '#dcfce7';
  if (score >= 40) return '#fef3c7';
  return '#f3f4f6';
};

// Mini bar chart (pure SVG — no canvas)
function BarChart({
  data,
  primaryColor,
}: {
  data: Array<{ day: string; count: number }>;
  primaryColor: string;
}) {
  const maxCount = Math.max(...data.map((d) => d.count), 1);
  const chartWidth = 400;
  const chartHeight = 80;
  const barWidth = 40;
  const gap = (chartWidth - data.length * barWidth) / (data.length + 1);

  return (
    <Svg width={chartWidth} height={chartHeight + 20}>
      {data.map((d, i) => {
        const barHeight = (d.count / maxCount) * chartHeight;
        const x = gap + i * (barWidth + gap);
        const y = chartHeight - barHeight;

        return (
          <G key={d.day}>
            <Rect
              x={x}
              y={y}
              width={barWidth}
              height={barHeight}
              fill={primaryColor}
              rx={4}
              opacity={0.85}
            />
            <Text
              style={{ fontSize: 8, color: '#6b7280', textAnchor: 'middle' } as any}
              x={x + barWidth / 2}
              y={chartHeight + 14}
            >
              {d.day}
            </Text>
            {d.count > 0 && (
              <Text
                style={{ fontSize: 7.5, color: '#111827', textAnchor: 'middle' } as any}
                x={x + barWidth / 2}
                y={y - 4}
              >
                {d.count}
              </Text>
            )}
          </G>
        );
      })}
    </Svg>
  );
}

export function WeeklyReportDocument({
  businessName,
  logoUrl,
  primaryColor,
  reportPeriod,
  stats,
  topLeads,
  sourceBreakdown,
  weeklyTrend,
}: WeeklyReportProps) {
  const leadDelta = stats.newThisWeek - (stats.totalLeads - stats.newThisWeek);
  const leadDeltaStr = leadDelta >= 0 ? `+${leadDelta} vs prior week` : `${leadDelta} vs prior week`;

  return (
    <Document
      title={`Weekly Report — ${businessName} — ${reportPeriod}`}
      author="Platform Analytics"
      creator="Agency Platform"
    >
      <Page size="A4" style={styles.page}>
        {/* Header */}
        <View style={[styles.header, { backgroundColor: primaryColor }]}>
          <View style={styles.headerTop}>
            <View>
              <Text style={styles.businessName}>{businessName}</Text>
              <Text style={styles.reportTitle}>Weekly Performance Report</Text>
              <Text style={styles.period}>{reportPeriod}</Text>
            </View>
            {logoUrl && (
              <Image
                src={logoUrl}
                style={{ width: 48, height: 48, borderRadius: 8 }}
              />
            )}
          </View>
        </View>

        {/* KPI Cards */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Overview</Text>
          <View style={styles.statsGrid}>
            {[
              { label: 'Total Leads', value: stats.totalLeads, delta: leadDeltaStr, positive: leadDelta >= 0 },
              { label: 'Qualified Leads', value: stats.qualifiedLeads, delta: `${Math.round((stats.qualifiedLeads / Math.max(stats.totalLeads, 1)) * 100)}% of total`, positive: true },
              { label: 'Bookings', value: stats.totalBookings, delta: `${stats.completedBookings} completed`, positive: true },
              { label: 'Avg. Lead Score', value: `${stats.avgScore}/100`, delta: stats.avgScore >= 60 ? 'Above target' : 'Below target', positive: stats.avgScore >= 60 },
            ].map((card) => (
              <View key={card.label} style={styles.statCard}>
                <Text style={styles.statValue}>{card.value}</Text>
                <Text style={styles.statLabel}>{card.label}</Text>
                <Text style={[styles.statDelta, { color: card.positive ? '#16a34a' : '#dc2626' }]}>
                  {card.delta}
                </Text>
              </View>
            ))}
          </View>
        </View>

        {/* Daily trend chart */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Daily Lead Volume</Text>
          <BarChart data={weeklyTrend} primaryColor={primaryColor} />
        </View>

        {/* Top leads table */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Top Leads This Week</Text>
          <View style={styles.table}>
            <View style={styles.tableHeader}>
              {['Name', 'Email', 'Score', 'Source', 'Date'].map((h, i) => (
                <Text
                  key={h}
                  style={[
                    styles.tableHeaderCell,
                    { flex: i === 1 ? 2 : 1 },
                  ]}
                >
                  {h}
                </Text>
              ))}
            </View>
            {topLeads.map((lead, i) => (
              <View key={i} style={styles.tableRow}>
                <Text style={[styles.tableCell, { flex: 1 }]}>{lead.name}</Text>
                <Text style={[styles.tableCell, { flex: 2, color: '#2563eb' }]}>{lead.email}</Text>
                <View style={{ flex: 1 }}>
                  <View style={[styles.scoreChip, {
                    backgroundColor: scoreBackground(lead.score),
                    alignSelf: 'flex-start',
                  }]}>
                    <Text style={{ fontSize: 9, fontWeight: 700, color: scoreColor(lead.score) }}>
                      {lead.score}
                    </Text>
                  </View>
                </View>
                <Text style={[styles.tableCell, { flex: 1, textTransform: 'capitalize' }]}>
                  {lead.source.replace(/_/g, ' ')}
                </Text>
                <Text style={[styles.tableCell, { flex: 1 }]}>{lead.date}</Text>
              </View>
            ))}
          </View>
        </View>

        {/* Source breakdown */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Lead Sources</Text>
          <View style={{ gap: 6 }}>
            {sourceBreakdown.map((src) => (
              <View key={src.source} style={{ flexDirection: 'row', alignItems: 'center', gap: 10 }}>
                <Text style={{ fontSize: 9.5, color: '#374151', width: 100, textTransform: 'capitalize' }}>
                  {src.source.replace(/_/g, ' ')}
                </Text>
                <View style={{ flex: 1, backgroundColor: '#f3f4f6', borderRadius: 4, height: 8 }}>
                  <View style={{
                    width: `${src.percentage}%`,
                    backgroundColor: primaryColor,
                    borderRadius: 4,
                    height: 8,
                  }} />
                </View>
                <Text style={{ fontSize: 9.5, color: '#6b7280', width: 40, textAlign: 'right' }}>
                  {src.count} ({src.percentage}%)
                </Text>
              </View>
            ))}
          </View>
        </View>

        {/* Footer */}
        <View style={styles.footer} fixed>
          <Text style={styles.footerText}>
            Generated {new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
          </Text>
          <Text style={styles.footerText} render={({ pageNumber, totalPages }) =>
            `Page ${pageNumber} of ${totalPages}`
          } />
        </View>
      </Page>
    </Document>
  );
}
```

---
