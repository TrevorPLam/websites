### 36.5 Rollback Procedure

**Target: ≤ 3 minutes from incident detection to rollback.**

```bash
# ============================================================
# ROLLBACK RUNBOOK
# Run when: post-deploy error rate spike, LCP regression, data incident
# ============================================================

# Step 1: Identify the last good deployment (30 seconds)
vercel ls --prod --token=$VERCEL_TOKEN --scope=$VERCEL_ORG_ID
# Copy the deployment ID of the last known-good deployment

# Step 2: Promote the last good deployment (10 seconds)
# This atomically re-points the production domain — zero downtime
vercel promote <LAST_GOOD_DEPLOYMENT_ID> --token=$VERCEL_TOKEN --scope=$VERCEL_ORG_ID

# Step 3: Verify rollback (30 seconds)
curl -I https://agency.com | grep x-vercel-id
# Confirm x-vercel-id matches the rolled-back deployment

# Step 4: Disable the bad feature flag (if rollback is for a feature, not a bug)
# Dashboard → Feature Flags → [flag-name] → Set to 0% rollout
# This is instant — no deployment required (see Domain 16)

# ── IF DATABASE MIGRATION ALSO NEEDS ROLLBACK ──────────────
# (Only needed for Phase 3 "Contract" migrations — Phase 1 Expand is always safe)
# WARNING: only safe if no data has been written to new columns yet

supabase db push --db-url=$PROD_DATABASE_URL \
  --target-version <PREVIOUS_MIGRATION_VERSION>

# ── NUCLEAR OPTION: Point-in-time recovery ──────────────────
# Supabase PITR — restores entire database to a timestamp
# Use only for data corruption incidents (data loss is irreversible)
# Supabase Dashboard → Project Settings → Database → PITR
# Select timestamp BEFORE the incident
# ⚠️ This DOES lose all writes between the incident time and now
```

---
