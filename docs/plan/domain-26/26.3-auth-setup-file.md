# 26.3 Auth Setup File

**File:** `e2e/tests/auth.setup.ts`

```typescript
import { test as setup, expect } from '@playwright/test';
import { AUTH_PATHS } from '../playwright.config';

// ============================================================================
// AUTH SETUP
// Runs ONCE before all test projects.
// Creates authenticated sessions for each role and saves to .auth/*.json.
// Subsequent tests load these files instead of logging in each time.
// Reference: https://playwright.dev/docs/auth
// ============================================================================

const BASE_URL = process.env.PLAYWRIGHT_BASE_URL ?? 'http://localhost:3000';

// ── Agency owner (full platform admin, manages all tenants) ──────────────────

setup('authenticate as agency owner', async ({ page }) => {
  await page.goto(`${BASE_URL}/sign-in`);

  await page.getByLabel('Email address').fill(process.env.TEST_AGENCY_EMAIL!);
  await page.getByLabel('Password').fill(process.env.TEST_AGENCY_PASSWORD!);
  await page.getByRole('button', { name: 'Sign in' }).click();

  // Wait for redirect to dashboard (confirms successful auth)
  await page.waitForURL('**/dashboard**', { timeout: 15_000 });
  await expect(page.getByRole('heading', { name: 'Dashboard' })).toBeVisible();

  // Save session state
  await page.context().storageState({ path: AUTH_PATHS.agencyOwner });
});

// ── Tenant 1 admin ────────────────────────────────────────────────────────────

setup('authenticate as tenant 1 admin', async ({ page }) => {
  await page.goto(`${BASE_URL}/sign-in`);

  await page.getByLabel('Email address').fill(process.env.TEST_TENANT1_EMAIL!);
  await page.getByLabel('Password').fill(process.env.TEST_TENANT1_PASSWORD!);
  await page.getByRole('button', { name: 'Sign in' }).click();

  await page.waitForURL('**/dashboard**', { timeout: 15_000 });

  await page.context().storageState({ path: AUTH_PATHS.tenant1Admin });
});

// ── Super admin ───────────────────────────────────────────────────────────────

setup('authenticate as super admin', async ({ page }) => {
  await page.goto(`${process.env.PLAYWRIGHT_ADMIN_URL ?? 'http://localhost:3001'}/sign-in`);

  await page.getByLabel('Email address').fill(process.env.TEST_SUPERADMIN_EMAIL!);
  await page.getByLabel('Password').fill(process.env.TEST_SUPERADMIN_PASSWORD!);
  await page.getByRole('button', { name: 'Sign in' }).click();

  await page.waitForURL('**/admin/dashboard**', { timeout: 15_000 });

  await page.context().storageState({ path: AUTH_PATHS.superAdmin });
});
```
