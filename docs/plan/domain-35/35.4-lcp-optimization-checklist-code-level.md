### 35.4 LCP Optimization Checklist (Code-Level)

These are non-negotiable implementation patterns applied across all tenant marketing sites. [makersden](https://makersden.io/blog/optimize-web-vitals-in-nextjs-2025)

**Hero image — the #1 LCP element:**

```typescript
// ✅ CORRECT — hero image is always the LCP element
// next/image with priority=true skips lazy loading and emits
// <link rel="preload" as="image"> in <head> for the LCP candidate.

import Image from 'next/image';

export function HeroSection({ imageUrl, alt }: { imageUrl: string; alt: string }) {
  return (
    <section className="relative h-[560px] overflow-hidden">
      <Image
        src={imageUrl}
        alt={alt}
        fill
        priority                        // Preload + no lazy loading
        fetchPriority="high"            // Explicitly boost fetch priority
        sizes="100vw"                   // Full viewport width
        className="object-cover"
        quality={85}                    // 85 = sweet spot: quality vs size
        placeholder="blur"             // Base64 LQIP — no layout shift during load
        blurDataURL="data:image/svg+xml;base64,..."  // From build-time Plaiceholder
      />
    </section>
  );
}

// ❌ WRONG — never do this for above-the-fold images
// <Image src={url} alt={alt} fill />  ← no priority → treated as lazy → LCP suffers
// <img src={url} alt={alt} />         ← no optimization → no preload → no AVIF/WebP
```

**Font optimization — zero CLS from font swap:** [shahin](https://shahin.page/article/nextjs-font-optimization-google-local-self-hosting-performance)

```typescript
// File: apps/*/src/app/layout.tsx

import { Inter } from 'next/font/google';

// next/font downloads Inter at BUILD TIME, self-hosts it, and generates
// CSS size-adjust overrides for the system fallback font.
// Result: ZERO layout shift when the custom font loads — CLS = 0.00 from fonts.

const inter = Inter({
  subsets: ['latin'],
  display: 'swap',                           // FOUT (flash of unstyled text) is acceptable
  preload: true,                             // Generates <link rel="preload"> in <head>
  variable: '--font-inter',                  // CSS custom property for Tailwind integration
  fallback: ['system-ui', 'arial'],          // Explicit fallback — used for size-adjust
  adjustFontFallback: true,                  // Generates size-adjust, ascent-override etc.
});

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={inter.variable}>
      <body className="font-sans">
        {children}
      </body>
    </html>
  );
}

// If loading a LOCAL font (client's custom brand font):
import localFont from 'next/font/local';

const brandFont = localFont({
  src: [
    { path: './fonts/BrandFont-Regular.woff2', weight: '400', style: 'normal' },
    { path: './fonts/BrandFont-Bold.woff2', weight: '700', style: 'normal' },
  ],
  variable: '--font-brand',
  display: 'swap',
  preload: true,
  adjustFontFallback: 'Arial',
});
```

**Third-party scripts — never block LCP:** [eastondev](https://eastondev.com/blog/en/posts/dev/20251219-nextjs-core-web-vitals/)

```typescript
// File: apps/*/src/components/analytics/ThirdPartyScripts.tsx
// All third-party scripts use next/script with afterInteractive or lazyOnload
// NEVER use <script> tags directly — they block parsing

import Script from 'next/script';

interface ThirdPartyScriptsProps {
  googleAnalyticsId?: string;
  googleTagManagerId?: string;
  facebookPixelId?: string;
  analyticsConsent: boolean;    // From cookie consent (Domain 33)
  marketingConsent: boolean;
}

export function ThirdPartyScripts({
  googleAnalyticsId,
  googleTagManagerId,
  facebookPixelId,
  analyticsConsent,
  marketingConsent,
}: ThirdPartyScriptsProps) {
  return (
    <>
      {/* GTM: afterInteractive → loads after page becomes interactive */}
      {googleTagManagerId && analyticsConsent && (
        <Script
          id="gtm"
          strategy="afterInteractive"
          dangerouslySetInnerHTML={{
            __html: `
              (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
              j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
              'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
              })(window,document,'script','dataLayer','${googleTagManagerId}');
            `,
          }}
        />
      )}

      {/* GA4 direct (when no GTM): lazyOnload → loads during idle time */}
      {googleAnalyticsId && !googleTagManagerId && analyticsConsent && (
        <>
          <Script
            src={`https://www.googletagmanager.com/gtag/js?id=${googleAnalyticsId}`}
            strategy="lazyOnload"   // Never afterInteractive for raw gtag — too early
          />
          <Script
            id="ga4-init"
            strategy="lazyOnload"
            dangerouslySetInnerHTML={{
              __html: `
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', '${googleAnalyticsId}', {
                  send_page_view: true,
                  anonymize_ip: true
                });
                // GDPR Consent Mode v2
                gtag('consent', 'default', {
                  analytics_storage: '${analyticsConsent ? 'granted' : 'denied'}',
                  ad_storage: '${marketingConsent ? 'granted' : 'denied'}',
                  ad_user_data: '${marketingConsent ? 'granted' : 'denied'}',
                  ad_personalization: '${marketingConsent ? 'granted' : 'denied'}',
                });
              `,
            }}
          />
        </>
      )}

      {/* Facebook Pixel: lazyOnload — never blocks LCP */}
      {facebookPixelId && marketingConsent && (
        <Script
          id="fb-pixel"
          strategy="lazyOnload"
          dangerouslySetInnerHTML={{
            __html: `
              !function(f,b,e,v,n,t,s)
              {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
              n.callMethod.apply(n,arguments):n.queue.push(arguments)};
              if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
              n.queue=[];t=b.createElement(e);t.async=!0;
              t.src=v;s=b.getElementsByTagName(e)[0];
              s.parentNode.insertBefore(t,s)}(window, document,'script',
              'https://connect.facebook.net/en_US/fbevents.js');
              fbq('init', '${facebookPixelId}');
              fbq('track', 'PageView');
            `,
          }}
        />
      )}
    </>
  );
}
```

---
