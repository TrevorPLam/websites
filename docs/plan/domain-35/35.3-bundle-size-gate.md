### 35.3 Bundle Size Gate

**File:** `.size-limit.ts` (repo root)

```typescript
// ============================================================================
// SIZE-LIMIT CONFIG
// Enforces per-route JavaScript payload budgets.
// Run: pnpm size-limit → fails CI if any budget is exceeded.
// Reference: https://nextjs.org/docs/app/guides/package-bundling
// ============================================================================

const config = [
  // ── Marketing site pages ─────────────────────────────────────────────────
  {
    name: 'Marketing: Homepage (First Load JS)',
    path: '.next/static/chunks/pages/index.js',
    limit: '85 KB',
    gzip: true,
  },
  {
    name: 'Marketing: Service page',
    path: '.next/static/chunks/pages/services/[slug].js',
    limit: '60 KB',
    gzip: true,
  },
  {
    name: 'Marketing: Contact page',
    path: '.next/static/chunks/pages/contact.js',
    limit: '50 KB',
    gzip: true,
  },

  // ── Shared chunks ─────────────────────────────────────────────────────────
  {
    name: 'Framework chunk (React + Next.js runtime)',
    path: '.next/static/chunks/framework-*.js',
    limit: '50 KB',
    gzip: true,
  },
  {
    name: 'Main chunk (shared code)',
    path: '.next/static/chunks/main-*.js',
    limit: '40 KB',
    gzip: true,
  },

  // ── Portal pages ──────────────────────────────────────────────────────────
  {
    name: 'Portal: Dashboard First Load JS',
    path: '.next/static/chunks/pages/dashboard/index.js',
    limit: '120 KB', // Portal can be heavier — no SEO concern
    gzip: true,
  },
  {
    name: 'Portal: Leads page',
    path: '.next/static/chunks/pages/dashboard/leads.js',
    limit: '90 KB',
    gzip: true,
  },
];

export default config;
```

**File:** `packages/config/src/next.config.ts` (bundle analyzer wrapper)

```typescript
import type { NextConfig } from 'next';
import bundleAnalyzer from '@next/bundle-analyzer';

// ============================================================================
// BUNDLE ANALYZER CONFIG
// Enable: ANALYZE=true pnpm build
// Generates: .next/analyze/client.html + server.html
// ============================================================================

const withBundleAnalyzer = bundleAnalyzer({
  enabled: process.env.ANALYZE === 'true',
  openAnalyzer: false, // CI-safe: don't auto-open browser
});

export function withPerformanceDefaults(config: NextConfig): NextConfig {
  return withBundleAnalyzer({
    ...config,

    // Turbopack (stable in Next.js 16): faster builds, same output
    turbopack: {
      rules: {},
    },

    // Tree-shake: only import used icons from lucide-react
    experimental: {
      optimizePackageImports: [
        'lucide-react',
        '@radix-ui/react-icons',
        'date-fns',
        'lodash-es',
        '@react-pdf/renderer', // Lazy-load only in report job context
      ],
    },

    // Compiler options
    compiler: {
      removeConsole: process.env.NODE_ENV === 'production' ? { exclude: ['error', 'warn'] } : false,
    },

    // Images: WebP/AVIF by default
    images: {
      formats: ['image/avif', 'image/webp'],
      deviceSizes: [640, 750, 828, 1080, 1200, 1920],
      imageSizes: [16, 32, 48, 64, 96, 128, 256],
      minimumCacheTTL: 31536000, // 1 year — immutable images
    },
  });
}
```

---
