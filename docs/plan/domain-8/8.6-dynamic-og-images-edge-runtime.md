### 8.6 Dynamic OG Images â€” Edge Runtime

**File:** `sites/[base-site]/src/app/og/route.tsx` [buildwithmatija](https://buildwithmatija.com/blog/complete-guide-dynamic-og-image-generation-for-next-js-15)

```typescript
import { ImageResponse } from 'next/og';
import { NextRequest } from 'next/server';
import { db } from '@repo/db';

// Edge Runtime: ~0ms cold start, globally distributed
export const runtime = 'edge';

// Cache OG images aggressively (they change rarely)
export const revalidate = 86400; // 24 hours

export async function GET(req: NextRequest) {
  try {
    const { searchParams } = req.nextUrl;

    const title = searchParams.get('title') ?? 'Welcome';
    const subtitle = searchParams.get('subtitle') ?? '';
    const tenantId = searchParams.get('tenant') ?? '';
    const pageType = searchParams.get('type') ?? 'page';

    // Fetch tenant branding (colors, logo, font) from Redis-cached config
    // Falls back to defaults if tenant not found
    let brandConfig = {
      primaryColor: '#1a1a2e',
      accentColor: '#16213e',
      logoUrl: null as string | null,
      fontFamily: 'Inter',
      siteName: '',
    };

    if (tenantId) {
      const { data: tenant } = await db
        .from('tenants')
        .select('config')
        .eq('id', tenantId)
        .single();

      if (tenant?.config) {
        const cfg = tenant.config as any;
        brandConfig = {
          primaryColor: cfg.theme?.colors?.primary ?? '#1a1a2e',
          accentColor: cfg.theme?.colors?.accent ?? '#16213e',
          logoUrl: cfg.assets?.logo ?? null,
          fontFamily: cfg.theme?.fontFamily ?? 'Inter',
          siteName: cfg.identity?.siteName ?? '',
        };
      }
    }

    // Page type badge configuration
    const badges: Record<string, { label: string; emoji: string }> = {
      home: { label: 'HOME', emoji: 'ðŸ ' },
      service: { label: 'SERVICE', emoji: 'âš™ï¸' },
      blog: { label: 'BLOG', emoji: 'ðŸ“' },
      'blog-post': { label: 'ARTICLE', emoji: 'ðŸ“–' },
      about: { label: 'ABOUT US', emoji: 'ðŸ‘‹' },
      contact: { label: 'CONTACT', emoji: 'ðŸ“ž' },
      page: { label: 'PAGE', emoji: 'ðŸ“„' },
    };

    const badge = badges[pageType] ?? badges.page;
    const truncatedTitle = title.length > 60 ? title.substring(0, 60) + 'â€¦' : title;

    return new ImageResponse(
      (
        <div
          style={{
            height: '100%',
            width: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            backgroundColor: brandConfig.primaryColor,
            padding: '64px',
            position: 'relative',
          }}
        >
          {/* Subtle geometric background decoration */}
          <div
            style={{
              position: 'absolute',
              top: 0,
              right: 0,
              width: '500px',
              height: '500px',
              borderRadius: '50%',
              backgroundColor: brandConfig.accentColor,
              opacity: 0.3,
              transform: 'translate(150px, -150px)',
            }}
          />

          {/* Top: logo + badge */}
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            {brandConfig.logoUrl ? (
              // eslint-disable-next-line @next/next/no-img-element
              <img
                src={brandConfig.logoUrl}
                alt={brandConfig.siteName}
                height={60}
                style={{ objectFit: 'contain', maxWidth: '200px' }}
              />
            ) : (
              <div style={{ color: 'rgba(255,255,255,0.8)', fontSize: 28, fontWeight: 700 }}>
                {brandConfig.siteName}
              </div>
            )}

            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                backgroundColor: 'rgba(255,255,255,0.15)',
                border: '1px solid rgba(255,255,255,0.3)',
                borderRadius: '24px',
                padding: '10px 20px',
                color: 'white',
                fontSize: 20,
                fontWeight: 600,
              }}
            >
              {badge.emoji} {badge.label}
            </div>
          </div>

          {/* Center: title + subtitle */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: '20px', flex: 1, justifyContent: 'center' }}>
            <div
              style={{
                color: 'white',
                fontSize: truncatedTitle.length > 40 ? 60 : 72,
                fontWeight: 800,
                lineHeight: 1.1,
                textShadow: '0 4px 12px rgba(0,0,0,0.4)',
                maxWidth: '1000px',
              }}
            >
              {truncatedTitle}
            </div>

            {subtitle && (
              <div
                style={{
                  color: 'rgba(255,255,255,0.85)',
                  fontSize: 34,
                  fontWeight: 400,
                  lineHeight: 1.3,
                  maxWidth: '900px',
                }}
              >
                {subtitle}
              </div>
            )}
          </div>

          {/* Bottom: domain + trust indicator */}
          <div
            style={{
              display: 'flex',
              alignItems: 'center',
              gap: '10px',
              color: 'rgba(255,255,255,0.7)',
              fontSize: 22,
            }}
          >
            <div
              style={{
                width: 10,
                height: 10,
                borderRadius: '50%',
                backgroundColor: '#10b981',
              }}
            />
            {new URL(req.nextUrl).host}
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        // Custom font loaded from Google Fonts (cached by Edge)
        fonts: [],
      }
    );
  } catch (error) {
    // Fallback: plain white OG image with title text
    return new ImageResponse(
      (
        <div
          style={{
            height: '100%',
            width: '100%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            backgroundColor: '#0f172a',
            color: 'white',
            fontSize: 48,
            fontWeight: 700,
            padding: '40px',
            textAlign: 'center',
          }}
        >
          {String(error instanceof Error ? error.message : 'Error generating image')}
        </div>
      ),
      { width: 1200, height: 630 }
    );
  }
}
```

**Auto-linked from `generateMetadata()` (Â§8.2):**

```typescript
// In generateTenantMetadata():
const ogImageUrl = `${baseUrl}/og?tenant=${tenantId}&type=${page}&title=${encodeURIComponent(title)}&subtitle=${encodeURIComponent(description)}`;
```

---
