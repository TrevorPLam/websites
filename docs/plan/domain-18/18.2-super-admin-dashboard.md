### 18.2 Super Admin Dashboard

**File:** `apps/admin/src/app/dashboard/page.tsx`

```typescript
import { db } from '@repo/db';
import { headers } from 'next/headers';

async function getPlatformMetrics() {
  const [
    { count: totalTenants },
    { count: activeTenants },
    { count: trialTenants },
    { count: suspendedTenants },
    { data: recentLeads },
  ] = await Promise.all([
    db.from('tenants').select('*', { count: 'exact', head: true }),
    db.from('tenants').select('*', { count: 'exact', head: true }).eq('status', 'active'),
    db.from('tenants').select('*', { count: 'exact', head: true }).eq('status', 'trial'),
    db.from('tenants').select('*', { count: 'exact', head: true }).eq('status', 'suspended'),
    db.from('leads').select('id, created_at, tenant_id, score')
      .order('created_at', { ascending: false })
      .limit(5),
  ]);

  return {
    totalTenants: totalTenants ?? 0,
    activeTenants: activeTenants ?? 0,
    trialTenants: trialTenants ?? 0,
    suspendedTenants: suspendedTenants ?? 0,
    recentLeads: recentLeads ?? [],
  };
}

async function getTenantList(search?: string, status?: string) {
  let query = db
    .from('tenants')
    .select('id, config->identity->siteName, subdomain, custom_domain, status, billing_tier, created_at, onboarding_completed_at')
    .order('created_at', { ascending: false })
    .limit(50);

  if (search) {
    query = query.or(`subdomain.ilike.%${search}%,custom_domain.ilike.%${search}%`);
  }
  if (status) {
    query = query.eq('status', status as any);
  }

  const { data } = await query;
  return data ?? [];
}

export default async function AdminDashboard({
  searchParams,
}: {
  searchParams: Promise<{ search?: string; status?: string }>;
}) {
  const { search, status } = await searchParams;
  const [metrics, tenants] = await Promise.all([
    getPlatformMetrics(),
    getTenantList(search, status),
  ]);

  const statusColors: Record<string, string> = {
    active: 'bg-green-100 text-green-800',
    trial: 'bg-blue-100 text-blue-800',
    suspended: 'bg-red-100 text-red-800',
    cancelled: 'bg-gray-100 text-gray-600',
    pending: 'bg-yellow-100 text-yellow-800',
  };

  return (
    <main className="max-w-7xl mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold text-gray-900 mb-8">Platform Admin</h1>

      {/* Platform KPIs */}
      <section aria-labelledby="platform-metrics" className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
        <h2 id="platform-metrics" className="sr-only">Platform metrics</h2>
        <MetricCard label="Total Tenants" value={metrics.totalTenants} />
        <MetricCard label="Active" value={metrics.activeTenants} color="green" />
        <MetricCard label="Trial" value={metrics.trialTenants} color="blue" />
        <MetricCard label="Suspended" value={metrics.suspendedTenants} color="red" />
      </section>

      {/* Tenant search and filter */}
      <section aria-labelledby="tenant-list-heading">
        <div className="flex items-center justify-between mb-4">
          <h2 id="tenant-list-heading" className="text-xl font-semibold">Tenants</h2>
          <form className="flex gap-3">
            <input
              type="search"
              name="search"
              defaultValue={search}
              placeholder="Search domain or nameâ€¦"
              className="border border-gray-300 rounded-lg px-3 py-2 text-sm focus-visible:ring-2 focus-visible:ring-primary"
              aria-label="Search tenants"
            />
            <select
              name="status"
              defaultValue={status}
              className="border border-gray-300 rounded-lg px-3 py-2 text-sm"
              aria-label="Filter by status"
            >
              <option value="">All statuses</option>
              <option value="active">Active</option>
              <option value="trial">Trial</option>
              <option value="suspended">Suspended</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <button type="submit" className="bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
              Search
            </button>
          </form>
        </div>

        {/* Tenant table */}
        <div className="bg-white border border-gray-200 rounded-xl overflow-hidden">
          <table className="w-full text-sm" role="table">
            <thead>
              <tr className="border-b border-gray-200 bg-gray-50 text-left">
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Tenant</th>
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Domain</th>
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Status</th>
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Plan</th>
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Joined</th>
                <th scope="col" className="px-4 py-3 font-semibold text-gray-600">Actions</th>
              </tr>
            </thead>
            <tbody>
              {tenants.map((tenant: any) => (
                <tr key={tenant.id} className="border-b border-gray-100 hover:bg-gray-50">
                  <td className="px-4 py-3 font-medium text-gray-900">
                    {tenant['config->identity->siteName'] ?? tenant.subdomain ?? tenant.id.slice(0, 8)}
                  </td>
                  <td className="px-4 py-3 text-gray-500 font-mono text-xs">
                    {tenant.custom_domain ?? `${tenant.subdomain}.youragency.com`}
                  </td>
                  <td className="px-4 py-3">
                    <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold ${statusColors[tenant.status] ?? 'bg-gray-100 text-gray-600'}`}>
                      {tenant.status}
                    </span>
                  </td>
                  <td className="px-4 py-3 text-gray-600 capitalize">{tenant.billing_tier}</td>
                  <td className="px-4 py-3 text-gray-400 text-xs">
                    {new Date(tenant.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-4 py-3">
                    <div className="flex items-center gap-2">
                      <a
                        href={`/admin/tenants/${tenant.id}`}
                        className="text-primary underline text-xs hover:no-underline"
                      >
                        Manage
                      </a>
                      <ImpersonateButton tenantId={tenant.id} />
                    </div>
                  </td>
                </tr>
              ))}

              {tenants.length === 0 && (
                <tr>
                  <td colSpan={6} className="px-4 py-12 text-center text-gray-400">
                    No tenants found.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </section>
    </main>
  );
}

function MetricCard({ label, value, color = 'gray' }: { label: string; value: number; color?: string }) {
  const colorMap: Record<string, string> = {
    gray: 'text-gray-900',
    green: 'text-green-700',
    blue: 'text-blue-700',
    red: 'text-red-700',
  };
  return (
    <div className="bg-white border border-gray-200 rounded-xl p-5">
      <p className="text-sm text-gray-500">{label}</p>
      <p className={`text-4xl font-extrabold mt-1 ${colorMap[color]}`}>{value.toLocaleString()}</p>
    </div>
  );
}
```

---
