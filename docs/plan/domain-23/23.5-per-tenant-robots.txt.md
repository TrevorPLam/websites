# 23.5 Per-Tenant Robots.txt

**File:** `apps/*/src/app/robots.ts`

```typescript
import type { MetadataRoute } from 'next';
import { headers } from 'next/headers';
import { resolveTenant } from '@repo/multi-tenant/resolve-tenant';

export const dynamic = 'force-dynamic';

export default async function robots(): Promise<MetadataRoute.Robots> {
  const headersList = await headers();
  const tenantContext = await resolveTenant({ headers: headersList } as any);

  if (!tenantContext) {
    // Unknown domain — block indexing
    return {
      rules: { userAgent: '*', disallow: '/' },
    };
  }

  const { tenantId, status } = tenantContext;

  // Suspended/cancelled tenants: block all indexing
  if (status === 'suspended' || status === 'cancelled') {
    return {
      rules: { userAgent: '*', disallow: '/' },
    };
  }

  const domain = headersList.get('host') ?? '';
  const siteUrl = `https://${domain}`;

  return {
    rules: [
      {
        userAgent: '*',
        allow: '/',
        disallow: [
          '/api/', // Never index API routes
          '/thank-you', // Conversion pages — no SEO value
          '/booking/confirm', // Post-booking pages
          '/*?*', // Block query string URLs (UTM params etc)
        ],
      },
      {
        // Block AI crawlers from scraping client content
        userAgent: ['GPTBot', 'ClaudeBot', 'PerplexityBot', 'Applebot-Extended'],
        disallow: '/', // Clients can opt-in via dashboard setting
      },
    ],
    sitemap: `${siteUrl}/sitemap.xml`,
    host: siteUrl,
  };
}
```
