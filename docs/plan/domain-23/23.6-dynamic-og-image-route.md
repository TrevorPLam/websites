# 23.6 Dynamic OG Image Route

**File:** `apps/*/src/app/og/[[...path]]/route.tsx`

```typescript
import { ImageResponse } from 'next/og';
import { NextRequest } from 'next/server';
import { resolveTenant } from '@repo/multi-tenant/resolve-tenant';
import { db } from '@repo/db';

export const runtime = 'edge';

// ============================================================================
// DYNAMIC OG IMAGE GENERATOR (Edge Runtime)
// URL: /og               → Business homepage card
// URL: /og/services/slug → Service-specific card
// Reference: https://makerkit.dev/blog/tutorials/dynamic-og-image
// ============================================================================

export async function GET(req: NextRequest) {
  const url = new URL(req.url);
  const pathSegments = url.pathname.replace('/og', '').split('/').filter(Boolean);
  const pageType = pathSegments[0] ?? 'home';        // 'services', 'about', etc.
  const pageSlug = pathSegments[1] ?? null;            // Service slug

  // Resolve tenant from hostname
  const tenant = await resolveTenant(req);
  if (!tenant) {
    return new Response('Not found', { status: 404 });
  }

  // Fetch tenant config
  const { data } = await db
    .from('tenants')
    .select('config')
    .eq('id', tenant.tenantId)
    .single();

  const config = data?.config as any;
  if (!config) return new Response('Not found', { status: 404 });

  const identity = config.identity ?? {};
  const primaryColor = config.theme?.colors?.primary ?? '#2563eb';

  // Determine card content based on page type
  let title = identity.siteName ?? 'Professional Services';
  let subtitle = identity.tagline ?? identity.description ?? '';
  let badge = identity.industry ?? 'Local Business';

  if (pageType === 'services' && pageSlug) {
    const service = (identity.services ?? []).find(
      (s: any) => s.slug === pageSlug
    );
    if (service) {
      title = service.name;
      subtitle = service.description;
      badge = identity.siteName;
    }
  } else if (pageType === 'about') {
    title = `About ${identity.siteName}`;
    subtitle = identity.description ?? identity.tagline ?? '';
    badge = 'Our Story';
  } else if (pageType === 'contact') {
    title = `Contact ${identity.siteName}`;
    subtitle = identity.contact?.phone ?? identity.contact?.email ?? '';
    badge = identity.address?.city ? `${identity.address.city}, ${identity.address.state}` : 'Get in Touch';
  }

  // Truncate long strings
  const truncate = (str: string, max: number) =>
    str.length > max ? str.slice(0, max - 3) + '...' : str;

  return new ImageResponse(
    (
      <div
        style={{
          width: '100%',
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          justifyContent: 'space-between',
          backgroundColor: '#ffffff',
          fontFamily: 'Inter, system-ui, sans-serif',
          padding: '56px 60px',
          borderTop: `8px solid ${primaryColor}`,
        }}
      >
        {/* Badge */}
        <div
          style={{
            display: 'inline-flex',
            alignItems: 'center',
            backgroundColor: `${primaryColor}15`,
            color: primaryColor,
            fontSize: '18px',
            fontWeight: 600,
            padding: '8px 18px',
            borderRadius: '999px',
            alignSelf: 'flex-start',
            textTransform: 'uppercase',
            letterSpacing: '0.05em',
          }}
        >
          {truncate(badge, 40)}
        </div>

        {/* Main content */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
          <div
            style={{
              fontSize: title.length > 40 ? '44px' : '56px',
              fontWeight: 800,
              color: '#111827',
              lineHeight: 1.1,
            }}
          >
            {truncate(title, 60)}
          </div>

          {subtitle && (
            <div
              style={{
                fontSize: '24px',
                color: '#6b7280',
                lineHeight: 1.4,
              }}
            >
              {truncate(subtitle, 120)}
            </div>
          )}
        </div>

        {/* Footer */}
        <div
          style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
            {/* Logo placeholder (colored circle with initial) */}
            <div
              style={{
                width: 48,
                height: 48,
                borderRadius: '50%',
                backgroundColor: primaryColor,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                color: '#ffffff',
                fontSize: '22px',
                fontWeight: 700,
              }}
            >
              {identity.siteName?.charAt(0)?.toUpperCase() ?? 'B'}
            </div>
            <span style={{ fontSize: '22px', fontWeight: 600, color: '#374151' }}>
              {identity.siteName}
            </span>
          </div>

          {identity.contact?.phone && (
            <div style={{ fontSize: '20px', color: primaryColor, fontWeight: 600 }}>
              {identity.contact.phone}
            </div>
          )}
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
    }
  );
}
```
